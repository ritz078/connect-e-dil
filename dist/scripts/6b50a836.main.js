"use strict";angular.module("valentinoApp",["ngNotify","ngCookies","angucomplete-alt","ngAnimate","chart.js","btford.socket-io","ngSanitize","angularMoment","ngNanoscroller","ngEmoticons","ngRoute"]),console.log("▄████████  ▄██████▄  ███▄▄▄▄   ███▄▄▄▄      ▄████████  ▄████████     ███        ▄████████ ████████▄   ▄█   ▄█\n███    ███ ███    ███ ███▀▀▀██▄ ███▀▀▀██▄   ███    ███ ███    ███ ▀█████████▄   ███    ███ ███   ▀███ ███  ███\n███    █▀  ███    ███ ███   ███ ███   ███   ███    █▀  ███    █▀     ▀███▀▀██   ███    █▀  ███    ███ ███▌ ███\n███        ███    ███ ███   ███ ███   ███  ▄███▄▄▄     ███            ███   ▀  ▄███▄▄▄     ███    ███ ███▌ ███\n███        ███    ███ ███   ███ ███   ███ ▀▀███▀▀▀     ███            ███     ▀▀███▀▀▀     ███    ███ ███▌ ███\n███    █▄  ███    ███ ███   ███ ███   ███   ███    █▄  ███    █▄      ███       ███    █▄  ███    ███ ███  ███\n███    ███ ███    ███ ███   ███ ███   ███   ███    ███ ███    ███     ███       ███    ███ ███   ▄███ ███  ███▌    ▄\n████████▀   ▀██████▀   ▀█   █▀   ▀█   █▀    ██████████ ████████▀     ▄████▀     ██████████ ████████▀  █▀   █████▄▄██\n▀");var resolve={delay:function($q,$timeout){var delay=$q.defer();return $timeout(delay.resolve,50,!1),delay.promise}},app=angular.module("valentinoApp");app.run(["$http","$cookies",function($http,$cookies){$http.defaults.headers.post["X-CSRFToken"]=$cookies.csrftoken}]),app.config(["$routeProvider","$locationProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"../views/home.html",controller:"HomeController",resolve:resolve}).when("/rules",{templateUrl:"../views/rules.html",controller:"RulesController",resolve:resolve}).when("/shout/:id",{templateUrl:"../views/shout.html",controller:"ShoutController",resolve:resolve}).when("/user/:enrolmentNo",{templateUrl:"../views/user.html",controller:"UserController",resolve:resolve}).when("/leaderboard",{templateUrl:"../views/leaderboard.html",controller:"LeaderboardController",resolve:resolve}).otherwise({redirectTo:"/"})}]),Chart.defaults.global.scaleLineColor="rgba(255,255,255,.1)",Chart.defaults.global.scaleFontColor="rgba(255,255,255,0.8)",Chart.defaults.global.scaleFontFamily="latoregular,sans-serif",Chart.defaults.global.animationSteps=150,Chart.defaults.global.tooltipFillColor="rgba(131, 76, 196, 0.95)",Chart.defaults.global.tooltipFontFamily="latoregular,sans-serif",Chart.defaults.global.tooltipTitleFontFamily="lato-regular,sans-serif",Chart.defaults.global.animationSteps=30;var app=angular.module("valentinoApp");app.service("dataRules",["$http","$q",function($http,$q){var deferred=$q.defer();$http.get("/data/data.json").then(function(d){deferred.resolve(d)}),this.getRules=function(){return deferred.promise}}]),app.service("dataLeaderboard",["$http","$q","$cookies",function($http,$q,$cookies){var d1,d2;this.getLeaderboard=function(s,c,g){return d1=$q.defer(),$http.get("https://channeli.in/valentino/leaders/?start="+s+"&count="+c+"&gender="+g+"&PHPSESSID="+$cookies.PHPSESSID).success(function(d){d1.resolve(d)}),d1.promise},this.getCombinedLeaderboard=function(){return d2=$q.defer(),$http.get("https://channeli.in/valentino/leaders/?start=1&count=25&combined=true&PHPSESSID="+$cookies.PHPSESSID).success(function(d){d2.resolve(d)}),d2.promise}}]),app.service("dataShoutbox",["$http","$q",function($http,$q){var deferred;this.getShoutbox=function(s,e){return deferred=$q.defer(),$http.get("http://dil.channeli.in/messages/"+s+"/"+e).success(function(d){deferred.resolve(d)}),deferred.promise}}]),app.service("dataSingleShout",["$http","$q",function($http,$q){var deferred;this.getShoutData=function(id){return deferred=$q.defer(),$http.get("http://dil.channeli.in/message/"+id).success(function(d){deferred.resolve(d)}),deferred.promise}}]),app.service("embed",["$http","$q",function($http,$q){this.getVideo=function(input){var deferred=$q.defer(),regex=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[?=&+%\w-]*/gi,x=input.match(regex);if(String.prototype.truncate=function(n){return this.substr(0,n-1)+(this.length>n?"...":"")},x){var y=x[0].split("=");$http.get("https://www.googleapis.com/youtube/v3/videos?id="+y[1]+"&key=AIzaSyCoJ6dFXpqs39y48isvRjv_yKpPsRtS_Uc&part=snippet,contentDetails,statistics,status").success(function(e){deferred.resolve(e)})}return deferred.promise}}]),app.service("messages",["$http","$q","$cookies",function($http,$q,$cookies){var deferredSendMsg;this.sendMsg=function(d,e){return deferredSendMsg=$q.defer(),d.message||(d.message=e+" has sent you a rose."),$http.get("https://channeli.in/valentino/rose_handler/?rc="+d.rose_color+"&anon="+d.anon+"&to="+d.to+"&PHPSESSID="+$cookies.PHPSESSID+"&message="+d.message).success(function(d){deferredSendMsg.resolve(d)}).error(function(d){deferredSendMsg.resolve(d)}),deferredSendMsg.promise}}]),app.service("dataUser",["$http","$q","$cookies",function($http,$q,$cookies){var deferred;this.getUser=function(enr){return deferred=$q.defer(),$http.get("https://channeli.in/valentino/person_json/?enrol="+enr+"&PHPSESSID="+$cookies.PHPSESSID).success(function(d){deferred.resolve(d)}),deferred.promise}}]),app.factory("mySocket",function(socketFactory){var myIoSocket=io.connect("http://dil.channeli.in"),mySocket=socketFactory({ioSocket:myIoSocket});return mySocket}),app.service("dashData",["$http","$cookies","$q",function($http,$cookies,$q){var deferred;this.getData=function(e){return deferred=$q.defer(),$http.get("https://channeli.in/valentino/person_json_private/?enrol="+e+"&PHPSESSID="+$cookies.PHPSESSID).success(function(d){deferred.resolve(d)}),deferred.promise}}]);var app=angular.module("valentinoApp");app.filter("reverse",function(){return function(items){return void 0!==items?items.slice().reverse():void 0}}),app.filter("leaderBfilter",function(){return function(items,input){function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}var filtered=[];return void 0===input||""===input?items:(angular.forEach(items,function(item){0===item.name.indexOf(capitaliseFirstLetter(input))&&filtered.push(item)}),filtered)}}),app.filter("profanity",function(){var words=["sex","fuck","chod"];return function(input){return input?(angular.forEach(words,function(word){var x=word,len=word.length;String.prototype.repeat=function(num){return new Array(num+1).join(this)};var re=new RegExp(x,"g");input=input.replace(re,"*".repeat(len))}),input):void 0}}),app.filter("numberSuffix",function(){return function(input){return 1===input?input+"st":2===input?input+"nd":3===input?input+"rd":input+"th"}});var app=angular.module("valentinoApp");app.controller("ValentinoController",["ngNotify","$location","$scope","$http","dataLeaderboard","dataShoutbox","mySocket","$timeout","$interval",function(ngNotify,$location,$scope,$http,dataLeaderboard,dataShoutbox,mySocket){$scope.go=function(a){$location.path("/shout/"+a)},angular.element(".shout").on("click",angular.element("a"),function(e){alert("a"),e.preventDefault()}),$scope.shouts=[];var promiseShoutbox=dataShoutbox.getShoutbox(1,15);promiseShoutbox.then(function(d){$scope.shouts=d}),$scope.clb=[];var promiseLeaderboard=dataLeaderboard.getCombinedLeaderboard();promiseLeaderboard.then(function(d){$scope.clb=d}),$scope.submitShout=function(e){(13===e.keyCode||$("mentio-menu").is(":visible"))&&(13===e.keyCode&&!e.shiftKey&&$scope.user.content&&(e.preventDefault(),$scope.user.time=new Date,mySocket.emit("chat message",$scope.user.content),$scope.user.content="",mySocket.on("rfh",function(){ngNotify.set("Your message wasn't sent.You are being logged out",{position:"top",type:"error"})})),mySocket.on("sent",function(){}))},mySocket.on("chat message",function(d){$scope.shouts.unshift(d)}),$scope.loadShout=function(s){var addShoutPromise=dataShoutbox.getShoutbox(s+1,15);addShoutPromise.then(function(d){$scope.shouts=$scope.shouts.concat(d)})},$("#shoutInput").focus(function(){$(this).animate({height:"80px"})}),$("#shoutInput").blur(function(){$(this).animate({height:"40px"})})}]),app.controller("HomeController",["$scope","$interval","dashData","ngNotify","messages","$timeout",function($scope,$interval,dashData,ngNotify,messages){$scope.message={anon:!1,rose_color:"RR"},$scope.sendMessage=function(){if($scope.selectedReceiver.originalObject)if($scope.message.to=$scope.selectedReceiver.originalObject.id,$scope.message.anon&&$scope.message.message)ngNotify.set("Anonymous ? Really ? Why ? Why ? Why ?","error");else{var sendMsgPromise=messages.sendMsg($scope.message,$scope.dash.name);sendMsgPromise.then(function(d){d.success?(ngNotify.set("Your rose has been successfully sent . Cheers !!!",{position:"bottom",type:"success"}),$scope.selectedReceiver=0):d.info&&(ngNotify.set(d.msg,{position:"bottom",type:"error"}),$scope.selectedReceiver=0)})}},$("#tabs li a").click(function(e){$("#tabs li, #content .current").removeClass("current").removeClass("fadeInLeft"),$(this).parent().addClass("current");var currentTab=$(this).attr("href");$(currentTab).addClass("current fadeInLeft"),e.preventDefault()}),$scope.dash={};var d=JSON.parse(angular.element("#data")[0].innerHTML);if(d.error)ngNotify.set("Alert",{position:"top",type:"error"});else{$scope.dash=d;var daily={red_roses:[0,0,0,0,0,0,0,0],yellow_roses:[0,0,0,0,0,0,0,0]};angular.forEach(d.rr_daywise,function(x){daily.red_roses[x.day-1]=x.count}),angular.forEach(d.yr_daywise,function(x){daily.yellow_roses[x.day-1]=x.count}),$scope.lineChart={labels:["7th","8th","9th","10th","11th","12th","13th","14th"],series:["Red Roses","Yellow Roses"],data:[daily.red_roses,daily.yellow_roses],options:{scaleGridLineColor:"rgba(255,255,255,.05)",bezierCurve:!1}},$scope.pieChart2={labels:["Red Roses","Yellow Roses"],data:[d.red_roses,d.yellow_roses]}}}]),app.controller("RulesController",["$scope","dataRules",function($scope,dataRules){$scope.rules={};var valPromise=dataRules.getRules();valPromise.then(function(data){$scope.rules=data.data.rules})}]),app.controller("ShoutController",["$scope","$http","$sce","embed","$routeParams","dataSingleShout",function($scope,$http,$sce,embed,$routeParams,dataSingleShout){var shPromise=dataSingleShout.getShoutData($routeParams.id);shPromise.then(function(d){$scope.shout=d,String.prototype.truncate=function(n){return this.substr(0,n-1)+(this.length>n?"...":"")},$scope.shout.youtube={};var embedPromise=embed.getVideo($scope.shout.content);embedPromise.then(function(e){$scope.shout.youtube.id=e.items[0].id,$scope.shout.youtube.title=e.items[0].snippet.title,$scope.shout.youtube.desc=e.items[0].snippet.description.truncate(250),$scope.shout.youtube.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/"+e.items[0].id+"?autoplay=1&theme=light&rel=0")});var width=$(".center").width()-100,height=.5625*width;$scope.videoDimensions={height:height,width:width};var imgRegex=/((?:https?):\/\/\S*\.(?:gif|jpg|jpeg|tiff|png|svg|webp))/gi,img=$scope.shout.content.match(imgRegex);img&&($scope.shout.imageUrl=img[0])})}]),app.controller("UserController",["$scope","$http","$routeParams","dataUser",function($scope,$http,$routeParams,dataUser){var promise=dataUser.getUser($routeParams.enrolmentNo);promise.then(function(d){if(d.error)$scope.wall=d;else{$scope.wall=d,$scope.pieChart1={labels:["Bande","Bandiyan"],data:[d.male_roses,d.female_roses]},$scope.pieChart2={labels:["Red Roses","Yellow Roses"],data:[d.red_roses,d.yellow_roses]};var daily={red_roses:[0,0,0,0,0,0,0,0],yellow_roses:[0,0,0,0,0,0,0,0]};angular.forEach(d.rr_daywise,function(x){daily.red_roses[x.day-1]=x.count}),angular.forEach(d.yr_daywise,function(x){daily.yellow_roses[x.day-1]=x.count}),$scope.lineChart={labels:["7th","8th","9th","10th","11th","12th","13th","14th"],series:["Red Roses","Yellow Roses"],data:[daily.red_roses,daily.yellow_roses],options:{scaleGridLineColor:"rgba(255,255,255,.05)",bezierCurve:!1}}}}),$scope.pieChart={colors:[{fillColor:"rgba(255,255,255,0.3)",strokeColor:"rgba(255,255,255,0.3)",pointColor:"rgba(255,255,255,0.3)",pointStrokeColor:"rgba(255,255,255,0.3)",pointHighlightFill:"rgba(255,255,255,0.3)",pointHighlightStroke:"rgba(255,255,255,0.3)"},{fillColor:"rgba(255,255,255,0.7)",strokeColor:"rgba(255,255,255,0.7)",pointColor:"rgba(255,255,255,0.7)",pointStrokeColor:"rgba(255,255,255,0.7)",pointHighlightFill:"rgba(255,255,255,0.7)",pointHighlightStroke:"rgba(255,255,255,0.7)"}],options:{segmentShowStroke:!1}}}]),app.controller("LeaderboardController",["$scope","$cookies","$http","dataLeaderboard","$timeout",function($scope,$cookies,$http,dataLeaderboard){var promise=dataLeaderboard.getLeaderboard(1,100,"M");promise.then(function(d){$scope.users=d}),$scope.updateGender=function(e){var p1=dataLeaderboard.getLeaderboard(1,100,e);p1.then(function(d){$scope.users=d})},$scope.addtoLeaderboard=function(l){var add_promise=dataLeaderboard.getLeaderboard(l,5,$scope.selectedGender.gender);add_promise.then(function(ds){angular.forEach(ds,function(d){$scope.users.push(d)})})},$scope.selectedGender={gender:"M"}}]);